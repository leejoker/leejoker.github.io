<!doctype html>
<html lang="zh-CN">
<head>

    <meta charset="utf-8">
    <meta name="generator" content="Hugo 0.79.1" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Yapi的安装和使用 - ESPIER</title>
    <meta property="og:title" content="Yapi的安装和使用 - ESPIER">
    <meta property="og:type" content="article">
        
    <meta property="article:published_time" content="2020-01-10T23:42:00&#43;08:00">
        
        
    <meta property="article:modified_time" content="2020-01-10T23:42:00&#43;08:00">
        
    <meta name="description" content="Yapi的安装和使用">
        
    <meta name="author" content="leejoker">
    <meta property="og:url" content="http://leejoker.github.io/post/yapi%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E4%BD%BF%E7%94%A8/">

    <link rel="stylesheet" href="/css/normalize.css">
    
    <link rel="stylesheet" href="/css/syntax.css">
    
    <link rel="stylesheet" href="/css/style.css">

    </head>

<body>
<header id="header" class="clearfix">
    <div class="container">
        <div class="col-group">
            <div class="site-name ">
                
                    <a id="logo" href="http://leejoker.github.io/">
                        ESPIER
                    </a>
                
                <p class="description">一只JAVA程序猿的日常</p>
            </div>
            <div>
                <nav id="nav-menu" class="clearfix">
                    <a class="current" href="http://leejoker.github.io/">博客</a>
                    
                    <a  href="http://leejoker.github.io/archives/" title="归档">
                        归档
                    </a>
                    
                    <a  href="http://leejoker.github.io/about/" title="关于">
                        关于
                    </a>
                    
                </nav>
            </div>
        </div>
    </div>
</header>


<div id="body">
    <div class="container">
        <div class="col-group">

            <div class="col-8" id="main">
                <div class="res-cons">
                    <article class="post">
                        <header>
                            <h1 class="post-title">Yapi的安装和使用</h1>
                        </header>
                        <date class="post-meta meta-date">
                            2020年1月10日
                            23:42
                        </date>
                        
                        <div class="post-meta meta-category">
                            ，归类于
                            
                                <a href="/categories/%E5%B7%A5%E5%85%B7">工具</a>
                            
                        </div>
                        <aside id="toc" class="dismissed">
                            <span class="toc-title">目录 <a href="#" class="toc-dismiss"></a></span>
                            <nav id="TableOfContents">
  <ul>
    <li><a href="#获取yapi源码">获取Yapi源码</a></li>
    <li><a href="#安装和配置mongodbubuntu-1804">安装和配置MongoDB（Ubuntu 18.04）</a>
      <ul>
        <li><a href="#一些说明">一些说明</a></li>
        <li><a href="#安装mongodb服务端">安装MongoDB服务端</a></li>
        <li><a href="#安装mongodb客户端">安装MongoDB客户端</a></li>
        <li><a href="#配置mongodb">配置MongoDB</a></li>
      </ul>
    </li>
    <li><a href="#配置yapi">配置Yapi</a></li>
  </ul>
</nav>
                        </aside><div class="post-content">
                            <h2 id="获取yapi源码">获取Yapi源码</h2>
<p>在github上获取最新的<a href="https://github.com/YMFE/yapi">yapi源码</a>：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ git clone https://github.com/YMFE/yapi.git ~/yapi
</code></pre></div><p>通过npm或cnpm安装依赖：</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ cd ~/yapi
$ npm install
</code></pre></div><p>这样准备工作就完成了一半了，接下来安装mongodb。</p>
<h2 id="安装和配置mongodbubuntu-1804">安装和配置MongoDB（Ubuntu 18.04）</h2>
<h3 id="一些说明">一些说明</h3>
<p>这一部分建议读完之后再进行操作，有些操作可能会产生一些问题，为避免不必要的麻烦，特此声明！</p>
<h3 id="安装mongodb服务端">安装MongoDB服务端</h3>
<p>安装MongoDB的服务端可以通过<a href="https://www.mongodb.com/download-center/community">官网</a>进行下载，记得选择与自己系统相匹配的版本</p>
<p><img src="https://i.loli.net/2019/12/24/M5dSQlVhH9DibpE.png" alt="mongodb.png"></p>
<p>下载完成后，可以使用dpkg命令进行安装</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo dpkg -i mongodb-org-server_4.2.2_amd64.deb
</code></pre></div><p>创建mongodb的默认数据目录</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo mkdir -p /data/db
</code></pre></div><p>运行mongodb</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo mongod
</code></pre></div><p>这样，mongodb服务就启动了。</p>
<h3 id="安装mongodb客户端">安装MongoDB客户端</h3>
<p>安装了服务端后，还要安装客户端才能够连接数据库进行控制，官网也提供了<a href="https://www.mongodb.com/download-center/enterprise">Mongo Shell</a>，在Package处选择shell即可下载，不过由于是企业版本里的，我也没有去确认是否会收费，就没有尝试了。</p>
<p>我用的是Ubuntu包管理里的mongodb-clients</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ sudo apt install mongodb-clients
</code></pre></div><p>安装完成后，运行客户端</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ mongo
</code></pre></div><p>PS：如果通过包管理安装了mongodb-clients，最好还是通过包管理安装mongodb，下载的服务端可能和包管理中的客户端版本不匹配，然后被包管理卸载掉服务端，/(ㄒoㄒ)/~~</p>
<h3 id="配置mongodb">配置MongoDB</h3>
<p>使用客户端连接mongodb后，需要创建yapi数据库</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">&gt; use yapi
&gt; db.yapi.insert<span style="color:#f92672">({</span><span style="color:#e6db74">&#34;name&#34;</span>:<span style="color:#e6db74">&#34;init_data&#34;</span><span style="color:#f92672">})</span>
</code></pre></div><p>当然，你也可以用<a href="https://www.mongodb.com/download-center/compass">MongoDB Compass</a>操作数据库。</p>
<p>添加用户</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">&gt; use yapi
&gt; db.createUser<span style="color:#f92672">({</span> 
     user: <span style="color:#e6db74">&#34;yapi&#34;</span>, 
     pwd: <span style="color:#e6db74">&#34;123456&#34;</span>, 
     roles: <span style="color:#f92672">[</span> <span style="color:#f92672">{</span> role: <span style="color:#e6db74">&#34;dbOwner&#34;</span>, db: <span style="color:#e6db74">&#34;yapi&#34;</span> <span style="color:#f92672">}</span> <span style="color:#f92672">]</span>
   <span style="color:#f92672">})</span>
</code></pre></div><p>如果发生</p>
<blockquote>
<p>Error: couldn’t add user: Use of SCRAM-SHA-256 requires undigested passwords</p>
</blockquote>
<p>请增加 <strong>mechanisms</strong> 属性</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">&gt; use yapi
&gt; db.createUser<span style="color:#f92672">({</span> 
     user: <span style="color:#e6db74">&#34;yapi&#34;</span>, 
     pwd: <span style="color:#e6db74">&#34;123456&#34;</span>,
     roles: <span style="color:#f92672">[</span> <span style="color:#f92672">{</span> role: <span style="color:#e6db74">&#34;dbOwner&#34;</span>, db: <span style="color:#e6db74">&#34;yapi&#34;</span> <span style="color:#f92672">}</span> <span style="color:#f92672">]</span>,
     mechanisms : <span style="color:#f92672">[</span><span style="color:#e6db74">&#34;SCRAM-SHA-1&#34;</span><span style="color:#f92672">]</span> 
   <span style="color:#f92672">})</span>
</code></pre></div><p>对新增的用户进行验证</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">&gt; use yapi
&gt; db.auth<span style="color:#f92672">(</span><span style="color:#e6db74">&#39;yapi&#39;</span>,<span style="color:#e6db74">&#39;123456&#39;</span><span style="color:#f92672">)</span>
</code></pre></div><p>返回1的话就没有什么问题啦！记得一定要切换到对应数据库下建立用户！！！</p>
<h2 id="配置yapi">配置Yapi</h2>
<p>创建config.json配置文件</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ cd ~/yapi
$ cp config_example.json config.json
</code></pre></div><p>修改config.json文件</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;port&#34;</span>: <span style="color:#e6db74">&#34;3000&#34;</span>,
  <span style="color:#f92672">&#34;adminAccount&#34;</span>: <span style="color:#e6db74">&#34;you_email_address@email.com&#34;</span>,
  <span style="color:#f92672">&#34;db&#34;</span>: {
    <span style="color:#f92672">&#34;servername&#34;</span>: <span style="color:#e6db74">&#34;127.0.0.1&#34;</span>,
    <span style="color:#f92672">&#34;DATABASE&#34;</span>: <span style="color:#e6db74">&#34;yapi&#34;</span>,						<span style="color:#960050;background-color:#1e0010">//这里是刚才创建的mongo数据库</span>
    <span style="color:#f92672">&#34;port&#34;</span>: <span style="color:#ae81ff">27017</span>,
    <span style="color:#f92672">&#34;user&#34;</span>: <span style="color:#e6db74">&#34;yapi&#34;</span>,									<span style="color:#960050;background-color:#1e0010">//这里是刚才创建的用户</span>
    <span style="color:#f92672">&#34;pass&#34;</span>: <span style="color:#e6db74">&#34;123456&#34;</span>,
    <span style="color:#f92672">&#34;authSource&#34;</span>: <span style="color:#e6db74">&#34;&#34;</span>
  }
</code></pre></div><p>最后就是运行Yapi了</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">$ cd ~/yapi
$ npm start

&gt; yapi-vendor@1.8.6 start /home/liang/projects/git/yapi
&gt; node server/app.js

log: -------------------------------------swaggerSyncUtils constructor-----------------------------------------------
log: 服务已启动，请打开下面链接访问: 
http://127.0.0.1:3000/
log: mongodb load success...
</code></pre></div><p>PS：不知道是不是我哪里弄得不对，在yapi的目录直接运行npm start会找不到config.json配置文件，因为提示config.json文件的路径在&quot;../../config.json&quot;，这个位置是相对&quot;server/app.js&quot;来说的，也就是yapi目录的上级目录，这个地方我不是很理解，所以我直接把文件里声明的路径改了。</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js"><span style="color:#75715e">//文件路径是 ~/yapi/server/yapi.js
</span><span style="color:#75715e"></span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">config</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">require</span>(<span style="color:#e6db74">&#39;../../config.json&#39;</span>);  <span style="color:#75715e">//这里改成  ../config.json
</span></code></pre></div><p>这样Yapi目录中的config.json就可以正常生效了，log日志目录也可以采用类似的方式处理。</p>
                        </div>

                        <div class="post-meta meta-tags">
                            
                            <ul class="clearfix">
                                
                                <li><a href="/tags/%E5%B7%A5%E5%85%B7">工具</a></li>
                                
                            </ul>
                            
                        </div>
                    </article>
                    
                    <div id="comments"><span class="widget-title">评论</span>
  <script src="https://utteranc.es/client.js"
          repo="leejoker/blog_comm"
          issue-term="title"
          theme="github-light"
          crossorigin="anonymous"
          async>
  </script></div>

                </div>
            </div>
            <div id="secondary">
    <section class="widget">
        
    
<form id="search" method="POST" action="https://duckduckgo.com/">
    
    <input type="text" name="q" maxlength="255" placeholder="搜索...">
    
    <input type="hidden" name="sites" value="http://leejoker.github.io/">
    
    <input type="hidden" name="kp" value="-2">
    
    <input type="hidden" name="kh" value="1">
    
    <input type="hidden" name="kl" value="wt-wt">
    
    <input type="hidden" name="kg" value="p">
    
    <input type="hidden" name="kaf" value="1">
    
    
    <input type="hidden" name="k1" value="-1">

    

    
    
    <input type="hidden" name="k7" value="#ffffff">
    
    <input type="hidden" name="kj" value="#ffffff">
    
    <input type="hidden" name="ky" value="#eaeaea">
    
    <input type="hidden" name="kx" value="#6E7173">
    
    <input type="hidden" name="k8" value="#444">
    
    <input type="hidden" name="k9" value="#6E7173">
    
    <input type="hidden" name="kaa" value="#6E7173">
    
    <input type="hidden" name="kae" value="#6E7173">

    
    
    <input type="hidden" name="ko" value="1">
    
    <input type="hidden" name="kt" value="n">
    
    <input type="hidden" name="ka" value="g">
    
    <input type="hidden" name="ks" value="l">
    
    <input type="hidden" name="kv" value="1">

    <button type="submit" class="submit icon-search"></button>
</form>



    </section>

    <section class="widget">
        <h3 class="widget-title">分类</h3>
        <ul class="widget-list">
            
            <li>
                <a href="/categories/clojure">
                    clojure (5)
                </a>
            </li>
            
            <li>
                <a href="/categories/css">
                    css (1)
                </a>
            </li>
            
            <li>
                <a href="/categories/emacs">
                    emacs (1)
                </a>
            </li>
            
            <li>
                <a href="/categories/go">
                    go (3)
                </a>
            </li>
            
            <li>
                <a href="/categories/hexo">
                    hexo (1)
                </a>
            </li>
            
            <li>
                <a href="/categories/java">
                    java (7)
                </a>
            </li>
            
            <li>
                <a href="/categories/linux">
                    linux (2)
                </a>
            </li>
            
            <li>
                <a href="/categories/ruby">
                    ruby (1)
                </a>
            </li>
            
            <li>
                <a href="/categories/rust">
                    rust (1)
                </a>
            </li>
            
            <li>
                <a href="/categories/%E5%B7%A5%E5%85%B7">
                    工具 (1)
                </a>
            </li>
            
            <li>
                <a href="/categories/%E6%8A%80%E5%B7%A7">
                    技巧 (4)
                </a>
            </li>
            
            <li>
                <a href="/categories/%E6%9D%82%E6%96%87">
                    杂文 (2)
                </a>
            </li>
            
            <li>
                <a href="/categories/%E7%AE%97%E6%B3%95">
                    算法 (2)
                </a>
            </li>
            
            <li>
                <a href="/categories/%E8%AF%BB%E4%B9%A6">
                    读书 (1)
                </a>
            </li>
            
        </ul>
    </section>

    
    <section class="widget">
        <h3 class="widget-title">友情链接</h3>
        <ul class="widget-list">
            
            <li>
                <a rel="noreferrer noopener nofollow" href="https://github.com/leejoker" title="leejoker&#39;s Github">leejoker&#39;s Github</a>
            </li>
            
        </ul>
    </section>
    

    <section class="widget">
        <h3 class="widget-title">其它</h3>
        <ul class="widget-list">
            <li><a href="/index.xml">文章 RSS</a></li>
        </ul>
    </section>
</div>
        </div>
    </div>
</div>
<footer id="footer">
    <div class="container">
      &copy; 2020 <a rel="nofollow" href="http://leejoker.github.io/">ESPIER</a>.
        Powered by <a rel="nofollow noreferer noopener" href="https://gohugo.io">Hugo</a> &amp; <a rel="nofollow noreferer noopener" href="https://github.com/JokerQyou/maupassant-hugo">maupassant theme</a>.
    </div>
</footer>

<script type="text/javascript" src="/js/app.js" defer></script>

<script type="text/javascript" src='https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML' defer></script>


</body>
</html>
